# 도커

> 리눅스 컨테이너에 여러 기능을 추가함으로써 애플리케이션을 컨테이너로서 좀 더 쉽게 사용할 수 있게 만들어진 오픈 소스 프로젝트

### 기존의 가상화 기술과의 차이점

- AS-IS
  - 하이퍼바이저를 이용해 여러 개의 운영체제를 하나의 호스트에서 생성해 사용하는 방식, 여러 개의 운영체제는 가상 머신이라는 단위로 구별되고 각 가상 머신에는 우분투, CentOS 등의 운영체제가 설치되어 사용됨.
  - 하이퍼바이저에 의해 생성되고 관리되는 운영체제는 게스트 운영체제라고 하며, 각 게스트 운영체제는 다른 게스트 운영체제와는 완전히 독립된 공간과 시스템 자원을 할당받아 사용함
    > **💡 하이퍼바이저(Hypervisor)란?**  
    > 물리적 하드웨어를 가상화하여 여러 개의 가상 머신(VM)을 생성하고 실행할 수 있게 해주는 소프트웨어 계층입니다.  
    > "가상 머신 모니터(VMM: Virtual Machine Monitor)"라고도 불립니다.
    >
    > **주요 유형:**
    >
    > 1. Type 1 (베어메탈 하이퍼바이저)
    >
    >    - 하드웨어에 직접 설치
    >    - 예: VMware ESXi, Microsoft Hyper-V, Xen
    >
    > 2. Type 2 (호스트 하이퍼바이저)
    >    - 호스트 OS 위에서 실행
    >    - 예: VMware Workstation, VirtualBox
    >
    > **주요 기능:**
    >
    > - 물리적 리소스 가상화 및 관리
    > - 가상 머신 격리성 보장
    > - 리소스 할당 및 스케줄링
    > - VM 생성/실행/관리
- PROBLEM
  - 각종 시스템 자원을 가상화하고, 독립된 공간을 생성하는 작업은 하이퍼바이저를 반드시 거치기 때문에 일반 호스트에 비해 성능의 손실이 발생함
  - 가상 머신은 운영체제 베이스라서 이미지 크기가 큼
- TO-BE

  - 가상화된 공간을 생성하기 위해 리눅스의 자체 기능인 chroot, namespace, cgroup을 사용함으로써 프로세스 단위의 격리 환경을 만들기 때문에 성능 손실이 거의 없음
  - 컨테이너에 필요한 커널은 호스트 커널을 공유해 사용
  - 컨테이너 안에서는 애플리케이션을 구동하는데 필요한 라이브러리 및 실행 파일만 존재하기 때문에 컨테이너를 이미지로 만들었을 때 이미지의 용량 또한 가상 머신에 비해 대폭 줄어듬
  - 도커 이미지는 가상 머신의 이미지와 달리 커널을 ���함하고 있지 않기 때문에 이미지 크기가 그다지 크지 않음

        > **💡 커널(Kernel)이란?**
        > 운영체제의 핵심 구성요소로서 하드웨어와 소프트웨어 간의 중개자 역할을 하는 프로그램입니다.
        >
        > **주요 기능:**
        >
        > - 하드웨어 자원 관리 (CPU, 메모리, 디스크 등)
        > - 프로세스 관리 및 스케줄링
        > - 메모리 관리 및 보호
        > - 파일 시스템 관리

### 도커를 시작해야 하는 이유

- 애플리케이션의 개발과 배포가 편해짐
- 여러 애플리케이션의 독립성과 확작성이 높아짐

### 도커 툴박스와 도커 for Windows/Mac의 차이점

- 도커 툴박스는 PC에 리눅스 가상 머신을 생성한 뒤 도커를 설치

  - 이 과정에서 가상 네트워크가 2개 생성됨
    - 하나는 도커 호스트를 위한 네트워크
    - 다른 하나는 내부 IP를 가진 가상 머진 안에 NAT IP를 할당 받은 도커 컨테이너가 생성
  - 따라서 외부에서 컨테이너에 접근하기 위해서는 2중 포트포워딩이 되야한다.
  - 컨테이너 사이의 포트포워딩은 도커를 띄울 때 쉽게 설정할 수 있다.

    > **💡 NAT(Network Address Translation)와 포트포워딩이란?**  
    > NAT는 사설 IP 주소를 공인 IP 주소로 변환하는 기술입니다.
    >
    > **주요 특징:**
    >
    > 1. NAT의 목적
    >
    >    - IP 주소 절약
    >    - 내부 네트워크 보안
    >    - 네트워크 주소 관리 용이
    >
    > 2. 포트포워딩
    >    - NAT 환경에서 외부에서 내부 네트워크로 접속하기 위한 기술
    >    - 특정 포트로 들어오는 트래픽을 내부 IP의 특정 포트로 전달
    >
    > **도커에서의 NAT와 포트포워딩:**
    >
    > - 도커 컨테이너는 기본적으로 NAT 네트워크를 사용
    > - 컨테이너는 내부 IP를 할당받음
    > - 호스트의 포트와 컨테이너의 포트를 매핑하여 외부 접속 가능
    > - 예: `docker run -p 8080:80` (호스트의 8080 포트를 컨테이너의 80 포트로 포워딩)

- 도커 for Windows/Mac은 도커 툴박스와 달리 가상 머신을 생성하지 않고 도커를 설치하기 때문에 포트포워딩이 필요 없음
  - 가체 가상화 기술로 리눅스 환경을 만들어 컨테이너를 생성(리눅스킷)
